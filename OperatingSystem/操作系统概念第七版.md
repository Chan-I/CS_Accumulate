# 操作系统——01：进程的概念

## 第一章	导论

​	操作系统是作为计算机硬件和计算机用户之间的中介的程序。操作系统的目的就是为用户提供方便且有效的执行程序的环境。操作系统是管理计算机硬件的软件。硬件必须提供合适的机制来保证计算机系统的正确运行，以及确保系统不受用户程序干扰正常运行。根据操作系统的不同组织方式，他们内部各不相同。设计一个新的操作系统是主要的任务。在设计开始之前明确所涉及的操作系统的目标时非常重要的。这些目标构成了选择不同算法的策略的基础。因为操作系统太过于庞大而复杂，因此它必须被分块构造。每一块都是系统中明确定义的一部分，具有严格的输入、输出和功能。

​	**操作系统**是管理计算机硬件资源的程序，它还为应用程序提供基础，并且充当计算机硬件和计算机用户的中介。在研究计算机操作系统的细节之前，首先需要了解系统结构的知识。本章从讨论系统启动、I/O和存储的基本功能开始，并讨论能编写一个可用操作系统的基本计算机体系。由于操作系统非常庞大而且复杂，必须煮个部分的生成。每一个部分都必须是构造好的系统的一个部分，并严格定义了输入、输出和功能。本章提供了操作系统主要部件的梗概。

> * 提供对操作系统主要部件的浏览。
> * 提供基本的计算机体系结构的概述。

## 1.1	操作系统做什么

​	计算机系统大致可以分为四个部分：*计算机硬件、操作系统、系统程序、应用程序和用户*。操作系统就是帮助用户协调硬件，也就是说**操作系统是用户和计算机系统中间的纽带**。讨论操作系统就要从两个角度展开。

### 1.1.1	用户视角

​	用户的观点因为使用而变得不同，有些用户使用的是个人PC机。用户坐在大型机终端或者小型机的前面工作，其他用户通过其他的终端访问同一个机器。这些用户共享资源并可以交换资源。操作系统的设计就是为**资源使用**提供了优化：确保所有的CPU时间、内存、I/O都能得到充分的利用，并且确保没有用户使用超出其权限之外的资源。

### 1.1.2	计算机系统视角

​	从计算机的视角来看，操作系统时域硬件最为密切的程序。操作系统就可以作为**资源分配器**。计算机系统中有很多资源，用来解决CPU时间、内存空间、文件存储等问题。面对许多冲突的资源请求，操作系统必须决定何时为各个程序和用户分配资源，以便于计算机系统能够有效而公平的运行。众所周知，资源分配对多用户访问主机或者微型计算机特别重要。

​	操作系统一个稍微不同的点在于，强调各种I/O设备和用户程序的重要性，操作系统是控制程序。**控制程序**管理用户程序的执行以防止计算机资源的错误使用或使用不当。

### 1.1.3	操作系统的定义

​	操作系统已经从上述两个角度进行了分析。但是，对于操作系统没有一个特别完整的定义。操作系统之所以存在，是因为它们提供了一个**解决创建可用的计算机系统问题的合理途径**。

​	用户有各种各样的指令，从理论上说用户直接操作硬件是最高效的途径。但是这未必容易，所以才有了操作系统。这些用户的应用程序需要一些公共的操作，如控制I/O设备。这些I共同的控制和分配I/O设备资源的功能集合成了一个软件模块：操作系统。

## 1.2	计算机操作系统结构

​		现代通用计算机系统一个很重要的能力就是**多道程序处理**能力。这种思想如下：

> 操作系统同时将多个任务保存在内存中，作业集可以是作业池中的作业集的子集，这也是因为可以同时保存在内存中的作业数要远比可在作业池中的数量少。操作系统会选择一个位于内存中的作业并开始执行。最后，改作业可能必须等待另一个任务I/O操作的完成。
>
> 对于非多道程序设计，CPU就会有空闲的时候；对于多道程序系统，CPU就会简单的切换到另一个作业并开始执行。当该作业需要等待的时候，CPU会切换到另一个作业。最后第一个作业完成等待并重新获得CPU的使用权，只要有一个任务可以执行，CPU就不会空闲。



​	**分时操作系统**是多道程序设计的一种延伸。在分时系统中，虽然CPU还是通过在多个作业之间来回切换执行，但是由于切换频率很高，用户可以在程序运行期间与之进行交互。

> 分时操作系统采用CPU调度和多道程序设计的思路，为用户提供分时计算机的一个小部分。每个用户在内存中至少有一个程序。装进内存并执行的程序被称为**进程（process）**。当进程执行的时候，通常只会执行较短的一段时间，此时并未完成或者需要进行I/O操作。由于I/O操作一般比较耗时，操作系统为了不让CPU闲置，会将CPU切换到其他用户的程序。

​	如果有多个作业需要调度进内存，而同时内存容量不足。就需要进行**作业调度**（job scheduling）。当操作系统从作业池中选择一个作业，将其调入内存来执行。内存中同时又多个程序可以运行，需要一定形式的内存管理。另外，如果有多个任务同时需要执行，需要系统做出选择，即CPU调度。最后多个并发执行的作业需要操作系统在各方面限制进程的互相影响，如进程调度、磁盘存储和内存管理。

​	在分时操作系统中，操作系统必须保证合理的响应时间，这些有时候需要通过交换得到。交换时候进程被换入内存或者由内存换出道磁盘。实现这一个目的可以采用虚拟内存，虚拟内存可以视为内存的逻辑扩展。

## 1.3 操作系统操作

​	程序执行过程中，势必会出现运行错误。操作系统和用户共享了计算机系统的硬件和软件。必须保证用户程序中一个出错仅仅只影响正在运行的程序。采用共享模式的话，许多程序会因为一个错误的影响陷入死循环。为此必须有一个能够处理此类问题的机制。

### 1.3.1	双重模式操作

​	为了保证操作系统的时时刻刻正确运行，必须首先区分什么程序是用户程序什么程序是操作系统的程序。一般通过增加一个模式位以表示当前模式：监督程序模式或者用户模式。有了模式位，就可以区分为操作系统所执行的任务和为用户所执行的任务。当计算机系统表示用户应用程序正在执行的时候，系统处于用户模式。然而，当用户应用程序需要操作操作系统的服务（系统调用），就必须从用户模式转换过来以执行请求。如下图：

